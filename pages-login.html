<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Login - VitalGuard</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />
    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />
    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet" />
    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    
    <!-- =======================================================
  * Template Name: VitalGuard
  * Updated: Sep 18 2023 with Bootstrap v5.3.2
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  </head>

  <body>
    <main>
      <div class="container">
        <section
          class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4"
        >
          <div class="container">
            <div class="row justify-content-center">
              <div
                class="col-lg-4 col-md-6 d-flex flex-column align-items-center justify-content-center"
              >
                <div class="d-flex justify-content-center py-4">
                  <a
                    href="admin_dash.html"
                    class="logo d-flex align-items-center w-auto"
                  >
                    <img src="assets/img/logo.png" alt="" />
                    <span class="d-none d-lg-block">VitalGuard</span>
                  </a>
                </div>
                <!-- End Logo -->
                <form onsubmit="login" id="loginForm">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="pt-4 pb-2">
                      <h5 class="card-title text-center pb-0 fs-4">
                        Login to Your Account
                      </h5>
                      <p class="text-center small">
                        Enter your phone number, password, and select your role
                        to login
                      </p>
                    </div>
                    <!-- <form id="MainForm"> -->
                      <form class="row g-3 needs-validation" novalidate>
                        <div class="col-12">
                          <label for="email" class="form-label"
                            >Email Id</label
                          >
                          <div class="input-group has-validation">
                            <!-- <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-telephone"></i></span> -->
                            <input
                              type="email"
                              class="form-control"
                              id="email"
                              placeholder="name@exampel.com"
                              required
                            />
                            <div class="invalid-feedback">
                              Please enter your phone number.
                            </div>
                          </div>
                        </div>
                        <div class="col-12">
                          <label for="password" class="form-label"
                            >Password</label
                          >
                          <input
                            type="password"
                            name="password"
                            class="form-control"
                            id="password"
                            placeholder="Enter Password"
                            required
                          />
                          <div class="invalid-feedback">
                            Please enter your password!
                          </div>
                        </div>
                        <div class="col-12">
                          <label for="selectRole" class="form-label"
                            >Select Role</label
                          >
                          <select
                            class="form-select"
                            name="role"
                            id="selectRole"
                            required
                          >
                            <option value="relative" selected>Relative</option>
                            <option value="doctor">Doctor</option>
                            <option value="admin">Admin</option>
                          </select>
                          <div class="invalid-feedback">
                            Please select your role.
                          </div>
                        </div>
                        <br />
                        <br />
                        <div class="col-12">
                          <button
                            class="btn btn-primary w-100"
                            type="submit"
                            id="loginButton"
                            
                          >
                            Login
                          </button>
                        </div>
                      </form>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>
    <!-- Vendor JS Files -->
    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/echarts/echarts.min.js"></script>
    <script src="assets/vendor/quill/quill.min.js"></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
    <!-- firebase.js link -->
    <!-- <script src="firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script> -->

    <script>
      // Get the login button element
      const loginButton = document.getElementById("loginButton");

      // Add an event listener for the login button click
      loginButton.addEventListener("click", function (event) {
        event.preventDefault(); // Prevent the default behavior of the form submission

        // Get the selected role from the dropdown
        const selectRole = document.getElementById("selectRole");
        const selectedRole = selectRole.value;

        
        // }
      });
      </script>
    <script type="module">
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js"; 
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
  
  const firebaseConfig = {
   apiKey: "AIzaSyBwelehXJt0qLOclGfvZKlVTGBv3e5sKbM",
  authDomain: "phone-authentication-3bd30.firebaseapp.com",
  projectId: "phone-authentication-3bd30",
  storageBucket: "phone-authentication-3bd30.appspot.com",
  messagingSenderId: "430805066047",
  appId: "1:430805066047:web:c976a27282f448a481738a",
  measurementId: "G-3D5MHSD9SM"
  };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const firestore = getFirestore(app);



  document.getElementById("loginButton").addEventListener("click", async function () {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const role = document.getElementById("selectRole").value;
  try {
           
            const userCredential = await signInWithEmailAndPassword(getAuth(), email, password);
            const user = userCredential.user;
 
    const userDoc = await getDoc(doc(firestore, "users", user.uid));
    if (userDoc.exists()) {
      const userData = userDoc.data();
      const userRole = userData.role;
      
     
     if (userRole === role) {
                  
                    switch (role) {
                        case "admin":
                            window.location.href = "admin_dash.html";
                            break;
                        case "doctor":
                            window.location.href = "doctor_dash.html";
                            break;
                        case "relative":
                            window.location.href = "relative_dash.html";
                            break;
                        default:
                            console.error("Unknown user role:", role);
                            // Handle error or redirect to default page
                    }
                } else {
                    // Unauthorized access
                    console.error("Unauthorized access for role:", role);
                    window.alert("Unauthorized access. Please login with the correct role.");
                }
            } else {
                console.error("User document not found.");
                // Handle error or redirect to default page
            }
        } catch (error) {
            // Handle login error
            console.error("Authentication error:", error.message);
            window.alert("Authentication error. Please try again.");
        }
    });

</script>
  </body>
</html>